
# Recon

***
# 1. Endpoint Enumeration

- [ ] **Port Scan**
```bash
cat subs.txt | naabu -ports 80,443,8080,8443,3000,4000,5000,7000,8000,9000,1337,2020,2021,4500,5013 -o gqlPorts.txt
```

- [ ] **Endpoint Scan**
```bash
nuclei -list gqlPorts.txt -t ~/nuclei-templates/j4xx3n/graphql-endpoint-discovery.yaml

nuclei -list urls.txt -t ~/nuclei-templates/j4xx3n/graphql-introspection-detect.yaml
```

- [ ] **Search URLs**
```bash
grep -Ei '(altair|api/(gql|graphiql|graphql)|graphql(\.php|/console|/schema\.(json|xml|yaml))?|playground|subscriptions|explorer|gql|graph)' urls.txt
```

**Found Endpoints**
```

```


# 2. Introspection

- [ ] **Test if introspection is disabled**
```json
query IntrospectionTest {
  __schema {
    queryType {
      name
    }
  }
}
```

- [ ] **InQL**
1. Open inql in burp suite and enter the graphql endpoint in the URL field.
## 2.2 Introspection Bypass

- [ ] **Test query with GET request**
```
GET /graphql?query=query%7B__schema%0A%7BqueryType%7Bname%7D%7D%7D
```

- [ ] **Clairvoyance**
```bash
clairvoyance https://example.com/graphql -o example.json
```

- [ ] **Test field suggestion**
1. Find a working query/mutation with a field.
2. Remove the last letter of the field name and send request.
3. Check if the full field name is provided in the response.

- [ ]  **Test for Field Stuffing**
```json
query { 
  user { 
    name
    id
    uuid
    password
  } 
}
```

- [ ] **Test for Type Stuffing**
```json
{ 
  __type(name:"PasteObject") { 
    name 
    fields { 
	  name 
    } 
  } 
}
```

## 2.3 Custom Wordlist Scan
- [ ] Cewl
```bash
cewl https://example.com:8080/
```
- [ ] Scan
```bash
clairvoyance https://example.com/graphql -o example.json
```



# 3. Fingerprint
- [ ] **Graphw00f**
```bash
python3 main.py -f -t https://example.com/graphql
```




# Attack
***
# 4. Exploitation

- [ ] **IDOR/Broken Access Control**
- [ ] **Injection** 
	- [ ] **Attack Surface**
		- Query Arguments
			- Int-type arguments can be changed to -1 to attempt to return all data
			- String-type arguments can be used to inject payloads
		- Field Arguments
			- Example:
				`query { users { username(capitalize: true) id } }` 
			- Test with same methods as query arguments
		- Query directive arguments
			- Example:
				`query { pastes { id ipAddr @show_network(style: "cidr") } }`
		- Operation Names
			- Potential injection vector
			- Test if special characters are allowed
			- Typically alphanumeric but some Graphql endpoints are more permissive when it comes to the characters they allow
	- [ ] **SQLi** 
		- [ ] **Attack Surface**
			- [ ] Find all place you can make an alteration to 
		- [ ] **Reflected**
		- [ ] **Blind**
	- [ ] **XSS**
		- [ ] **Attack Surface**
		- [ ] **Reflected**
		- [ ] **Blind**
- [ ] **CSRF**
- [ ] **SSRF**



# 5. Graphql-cop

- [ ] [MEDIUM] GET Method Query Support - GraphQL queries allowed using the GET method (Possible Cross Site Request Forgery (CSRF))
- [ ] 





# Notes
***


- [ ] **Introspection cURL command** 
```bash
curl -s -X POST http://localhost:5013/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"query IntrospectionQuery { __schema { queryType { name } mutationType { name } subscriptionType { name } types { ...FullType } directives { name description locations args { ...InputValue } } } } fragment FullType on __Type { kind name description fields(includeDeprecated: true) { name description args { ...InputValue } type { ...TypeRef } isDeprecated deprecationReason } inputFields { ...InputValue } interfaces { ...TypeRef } enumValues(includeDeprecated: true) { name description isDeprecated deprecationReason } possibleTypes { ...TypeRef } } fragment InputValue on __InputValue { name description type { ...TypeRef } defaultValue } fragment TypeRef on __Type { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name ofType { kind name } } } } } } }"}'
```

- [ ] Query schema for just query name and fields
```json
query {
	__schema {
		types {
			name, fields{name}
		}
	}
}
```
